{% extends "layout.htm" %}

{% block title %} Jinny's holidays vibes {% endblock title %}

{% block body %}
    <script src="https://d3js.org/d3.v4.min.js"></script>


    <style>
        .myCircle:hover {
            stroke:#e6eef4;
        }
    </style>


    <script id="preference_template" type="text/x-handlebars-template">
        {% raw %}

        <ul class="container" style="list-style: none;">
            <li class="my-2">Your city is <strong>{{cityname}}</strong></li>
            <br>
            <li class="my-2">From <strong>{{start_date}}</strong></li>
            <li class="my-2">to <strong>{{end_date}}</strong></li>
            <br>
            <li class="my-2"> Your preferred temperature is <strong> {{temperature}} °C </strong></li>
            <br>
            <li class="my-2"> Your budget is between <strong>£ {{minbud}}</strong> and <strong>£ {{maxbud}}</strong></li>
        </ul>

        {% endraw %}
    </script>

    <main class="mt-5 pt-5">
    <div class="container" style="opacity: 0.95;">

        <!--Section: Post-->
        <section class="mt-4">

            {% if session.loginUser %}
            <div class="row">

                <div class="col-md-8 mb-4">

                    <div class="card mb-4 wow fadeIn">
                        <div id="linechart">

                        </div>
                    </div>
                </div>

            <div class="col-md-4 mb-4">
                <div class="card mb-4 text-center wow fadeIn">


                    <div id="session_user" class="card-header h5 mdb-color-text ">
                        <h1 class='my-2 mdb-color darken-1 white-text text-bold'> Welcome, <strong> {{session.loginUser.name}}! </strong> </h1>
                        
                        <div class="class-body my-4">
                            <div class="card mb-4 text-center wow fadeIn">

                                <div class="card-header h4 mdb-color darken-3 white-text ">My Preferences</div>
                
                                <!--Card content-->
                                <div id="pref_list"class="card-body">
                                    Please select all the preference choices.
                                </div>
                            </div>
                        </div>

                        <a class="btn btn-outline-primary my-3" href="/mymenu" role="button" target="_blank">Set or see your preference  <i class="fab fa-gulp"></i> </a>


                    </div> 
                </div>
            

                      <!--Card-->
                <div class="card my-4 wow fadeIn">

                    <div class="card-header h4 mdb-color-text text-center"> Related articles </div>
    
                        <!--Card content-->
                        <div class="card-body my-3">
    
                            <ul class="list-unstyled">
                                <li class="media">
                                    <img class="d-flex mr-3" src="https://imgcy.trivago.com/c_lfill,f_auto,g_faces,h_320,q_auto:good,w_488/mag/2018/03/29093835/coolest-hotels-in-new-york-city-1024x683.jpg" width="90px" height="90px" alt="Trivago New York image">
                                    <div class="media-body">
                                        <a href="https://magazine.trivago.com/lower-east-side-hotels/">
                                            <h5 class="mx-3 my-1 mdb-color-text font-weight-bold" >New York City's Cauldron of Creativity</h5>
                                        </a>
                                        <p class="mx-3 my-1">10 Coolest Hotels in the Lower East Side</p>
                                    </div>
                                </li>
                            </ul>
                        </div>
                        <!--/.Card-->
    
                    </div>
                    <!--Grid column-->
            </div>




            {% else %}
            <!--Grid row-->
            <div class="row">

                <!--Grid column-->
                <div class="col-md-8 mb-4">

                    <!--Featured Image-->
                    <div class="card mb-4 wow fadeIn">

                      <!-- carousel -->
    <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
            <ol class="carousel-indicators">
                <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
                <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
                <li data-target="#carouselExampleIndicators" data-slide-to="2"></li>
            </ol>
            <div class="carousel-inner">
                <div class="carousel-item active">
                <img src="https://wallpaper.wiki/wp-content/uploads/2018/06/Scenes-Around-Europe10.jpg" class="d-block w-100" alt="Europe https://wallpaper.wiki">
                </div>
                <div class="carousel-item">
                <img src="https://wallpaper.wiki/wp-content/uploads/2018/10/Mexico-is-colorful13.jpg" class="d-block w-100" alt="Mexico https://wallpaper.wiki">
                </div>
                <div class="carousel-item">
                <img src="https://wallpaper.wiki/wp-content/uploads/2018/05/Beautiful-Queensland6.jpg" class="d-block w-100" alt="Queensland https://wallpaper.wiki">
                </div>
            </div>
            <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="sr-only">Previous</span>
            </a>
            <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="sr-only">Next</span>
            </a>
            </div>
                    </div>
                    <!--/.Featured Image-->

                    <!--Card-->
                    <div class="card wow fadeIn">

                        <!--Card content-->
                        <div class="card-body text-center">

                        <!-- Section: Blog v.2 -->
                        <section id="default_recom" class="text-center">

                        <!-- Section heading -->
                        <div class="card-header font-weight-bold h2 mdb-color-text mb-3">Recommendations</div>
                        <!-- Section description -->
                        <div class="dark-grey-text mx-2 mb-5 md">
                            Holidaymakers wonder when and where is the ideal to book their 'routine-break'. <br>
                            If you are fed up with fully packed, peaked season getaways, this recommendation will help. This non-commercial website helps you planning the most suitable place for you and guides you packing up depending on its weather. 
                        </div>

                        <!-- Grid row -->
                        <div class="row">

                        <!-- Grid column -->
                        <div class="col-lg-4 col-md-12 mb-lg-0 mb-4">

                            <!-- Featured image -->
                            <div class="view overlay rounded z-depth-2 mb-4">
                            <img class="img-fluid" src="static/img/London2.jpeg" alt="London">
                            <a>
                                <div class="mask rgba-white-slight"></div>
                            </a>
                            </div>

                            <!-- Category -->
                            <a href="#!">
                            <h6 class="font-weight-bold mb-3 mdb-color-text"><i class="fas fa-map-marked-alt"></i></i> Europe</h6>
                            </a>
                            <!-- Post title -->
                            <h4 class="font-weight-bold mdb-color-text mb-3"><strong>London</strong></h4>
                            <!-- Post datfa -->
                      
                            <!-- Excerpt -->
                            <p class="dark-grey-text">London is one of most popular destinations in Europe, luring travelers year round. It has so much to offer with its world-class galleries, phenomenal shopping and an amazing culinary scene.</p>
                            <!-- Read more button -->
                            <!-- <a href="" class="btn mdb-color white-text btn-rounded btn-md">Read more</a> -->

                        </div>
                        <!-- Grid column -->

                        <!-- Grid column -->
                        <div class="col-lg-4 col-md-6 mb-md-0 mb-4">

                            <!-- Featured image -->
                            <div class="view overlay rounded z-depth-2 mb-4">
                            <img class="img-fluid" src="static/img/NewYork.jpg" alt="Newyork image">
                            <a>
                                <div class="mask rgba-white-slight"></div>
                            </a>
                            </div>

                            <!-- Category -->
                            <a href="#!" class="mdb-color-text">
                            <h6 class="font-weight-bold mdb-color-text mb-3"><i class="fas fa-map-marked-alt"></i></i> America</h6>
                            </a>
                            <!-- Post title -->
                            <h4 class="font-weight-bold mdb-color-text mb-3"><strong>New York City</strong></h4>
                            <!-- Post data -->
                            
                            <!-- Excerpt -->
                            <p class="dark-grey-text">New York City is one of the world’s most popular travel destinations. There’s nothing better than returning to your hotel to be pampered in the spa after a day of pounding the pavement.</p>
                            <!-- Read more button -->
                      

                        </div>
                        <!-- Grid column -->

                        <!-- Grid column -->
                        <div class="col-lg-4 col-md-6 mb-0">

                            <!-- Featured image -->
                            <div class="view overlay rounded z-depth-2 mb-4">
                            <img class="img-fluid" src="static/img/Sydney.jpg" alt="Sydney image">
                            <a>
                                <div class="mask rgba-white-slight"></div>
                            </a>
                            </div>

                            <!-- Category -->
                            <a href="#!" class="mdb-color-text">
                            <h6 class="font-weight-bold mb-3 mdb-color-text"><i class="fas fa-map-marked-alt"></i></i> Oceania</h6>
                            </a>
                            <!-- Post title -->
                            <h4 class="font-weight-bold mb-3 mdb-color-text"><strong>Sydney</strong></h4>
                            
                            <!-- Excerpt -->
                            <p class="dark-grey-text">Whether you're after breezy vistas, a peaceful oasis or country comforts, these New South Wales South accommodation options are perfect for your next escape from the city.</p>
                            <!-- Read more button -->
                

                        </div>
                        <!-- Grid column -->

                        </div>
                        <!-- Grid row -->

                        </section>
                        <!-- Section: Blog v.2 -->
                        <hr>

                        <a class="btn btn-outline-primary" href="/mymenu" role="button" target="_blank">Find your own journey <i class="far fa-calendar-alt"></i></a>

                        </div>

                    </div>

                    <!--/.Card-->

                </div>
                <!--Grid column-->

                <!--Grid column-->
                <div class="col-md-4 mb-4 ">
                    <div class="card mb-4 text-center wow fadeIn">

                        <div class="card-header h4 mdb-color-text mb-3">Sign in <img src="static/img/holidayicon.png" alt="holidayicon" width="32" height="32"></div>
        
                        <!--Card content-->
                        <div class="card-body">

                            <!-- Default form login -->
                            <form action="/login" method="POST">

                                <!-- Default input email -->
                                <label for="defaultLoginFormEmail" class="grey-text">Your email</label>

                                <input type="email" id="defaultLoginFormEmail" name="email" class="form-control" placeholder="E-mail" value="{{email}}" required>

                                <br>

                                <!-- Default input password -->
                                <label for="defaultLoginFormPassword" class="grey-text">Your Password</label>
                                <input type="password" id="defaultLoginFormPassword" name="passwd" class="form-control mb-4" placeholder="Password" required>

                                <div class="text-right mt-4">
                                    <button id="loginbtn" class="btn btn-md mdb-color lighten-2" type="submit">Sign in</button>
                                </div>

                                <p class='mt-4 mdb-color-text'>Not a member?
                                    <a href="/registration">Register</a>
                                </p>
                            </form>
                        </div>    
                
                    </div>


                      <!--Card-->
                <div class="card my-4 wow fadeIn">

                        <div class="card-header h4 mdb-color-text text-center"> Related articles </div>
    
                        <!--Card content-->
                        <div class="card-body my-3">
    
                            <ul class="list-unstyled">
                                <li class="media">
                                    <img class="d-flex mr-3" src="https://imgcy.trivago.com/c_lfill,f_auto,g_faces,h_320,q_auto:good,w_488/mag/2018/03/29093835/coolest-hotels-in-new-york-city-1024x683.jpg" width="90px" height="90px" alt="Trivago New York image">
                                    <div class="media-body">
                                        <a href="https://magazine.trivago.com/lower-east-side-hotels/">
                                            <h5 class="mx-3 my-1 mdb-color-text font-weight-bold" >New York City's Cauldron of Creativity</h5>
                                        </a>
                                        <p class="mx-3 my-1">10 Coolest Hotels in the Lower East Side</p>
                                    </div>
                                </li>
                                <li class="media my-4">
                                    <img class="d-flex mr-3" src="https://imgcy.trivago.com/c_lfill,f_auto,g_faces,q_auto:good,w_1534/mag/2019/02/04145545/coolest-hotels-in-berlin.jpg" width="90px" height="90px" alt="Berlin image">
                                    <div class="media-body">
                                        <a href="https://magazine.trivago.com/berlin-hotels/">
                                            <h5 class="mx-3 my-1 mdb-color-text font-weight-bold">Unique Places to Stay in Europe's Party Capital</h5>
                                        </a>
                                        <p class="mx-3 my-1 mdb-color-text">10 Coolest Hotels in Berlin</p>
                                    </div>
                                </li>
                                <li class="media">
                                    <img class="d-flex mr-3" src="https://imgcy.trivago.com/c_lfill,f_auto,g_faces,q_auto:good,w_1534/mag/2019/02/07134859/ski-resorts-victoria-falls-creek-accommodation1.jpg" width="90px" height="90px" alt="Victoria ski image">
                                    <div class="media-body">
                                        <a href="https://magazine.trivago.com.au/ski-resorts-victoria/">
                                            <h5 class="mt-0 mb-1 font-weight-bold" style='margin: 5px 10px;'>From Mt Buller to Falls Creek</h5>
                                        </a>
                                        <p style="margin: 5px 10px;">Accommodations for an iconic Victorian ski trip</p>
                                        
                                    </div>
                                </li>
                            </ul>
                        </div>
                        <!--/.Card-->
    
                    </div>
                    <!--Grid column-->
                {% endif %}



                </div>
            <!--Grid row-->

        </section>
        <!--Section: Post-->

    </div>
    </main>

<!-- background image end -->
<!-- </div> -->

{% endblock body %}

{% block jsfunction %}
    <script>

        let margin = {top: 50, right: 20, bottom: 50, left: 70},
        
        width = 650 - margin.left - margin.right,
        height = 500 - margin.top - margin.bottom;
    

        let svg = d3.select("#linechart")
                    .append("svg")
                        .attr("width", width + margin.left + margin.right)
                        .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                        .attr("transform",
                            "translate(" + margin.left + "," + margin.top + ")");
                    

        d3.csv("https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/connectedscatter.csv",
        
        function(d){
            return { date : d3.timeParse("%Y-%m-%d")(d.date), value : d.value }
        },
        
        function(data) {
        
            let x = d3.scaleTime()
                    .domain(d3.extent(data, function(d) { return d.date; }))
                    .range([ 0, width ]);

            svg.append("g")
            .attr("transform", "translate(0," + height + ")")
            .call(d3.axisBottom(x));
        
            let y = d3.scaleLinear()
                    .domain( [8000, 9200])
                    .range([ height, 0 ]);

            svg.append("g")
            .call(d3.axisLeft(y));
        
            svg.append("path")
            .datum(data)
            .attr("fill", "none")
            .attr("stroke", "black")
            .attr("stroke-width", 1.5)
            .attr("d", d3.line()
                .curve(d3.curveBasis)
                .x(function(d) { return x(d.date) })
                .y(function(d) { return y(d.value) })
                )
        
            let Tooltip = d3.select("#linechart")
                            .append("div")
                            .style("opacity", 0)
                            .attr("class", "tooltip")
                            .style("background-color", "white")
                            .style("border", "solid")
                            .style("border-width", "2px")
                            .style("border-radius", "5px")
                            .style("padding", "5px")
        
        
            let mouseover = function(d) {
                Tooltip
                .style("opacity", 1)
            };

            let mousemove = function(d) {
                Tooltip
                .html("Exact value is " + d.value)
                .style("left", (d3.mouse(this)[0]+70) + "px")
                .style("top", (d3.mouse(this)[1]) + "px")
            };

            let mouseleave = function(d) {
                Tooltip
                .style("opacity", 0)
            };
        
        
            svg
            .append("g")
            .selectAll("dot")
            .data(data)
            .enter()
            .append("circle")
                .attr("class", "myCircle")
                .attr("cx", function(d) { return x(d.date) } )
                .attr("cy", function(d) { return y(d.value) } )
                .attr("r", 8)
                .attr("stroke", "#697db2")
                .attr("stroke-width", 3)
                .attr("fill", "#abb7d6")
                .on("mouseover", mouseover)
                .on("mousemove", mousemove)
                .on("mouseleave", mouseleave)
        });


        if (userid){


            send_ajax('/mymenu/' + userid, 'GET', '', '', function(res){
                console.log(res)

                let pref_data = {
                    cityname: res.cityname,
                    end_date: res.end_date,
                    maxbud: res.maxbud,
                    minbud: res.minbud,
                    start_date: res.start_date,
                    temperature: res.temperature,
                    userid: res.userid
                };

                hbs("preference_template", pref_data, 'pref_list');
            })
            
        };



        
    </script>

{% endblock jsfunction %}
